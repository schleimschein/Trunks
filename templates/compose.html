{% extends "base.html" %}

{% block title %} New Post {% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/bulma-tagsinput.min.css') }}" media="all">
<link rel="stylesheet" href="{{ url_for('static', filename='css/bulma-switch.min.css') }}" media="all">


<link rel="stylesheet" href="{{ url_for('static', filename='css/awesomplete.css') }}" media="all">

{% endblock %}

{% block sidebar %}
<div class="content">
    <div class="panel">
        <div class="panel-heading">
            Options
        </div>

        <a class="panel-block" href="#save-as-draft" id="action-draft">
            <span class="panel-icon">
                <i class="fa fa-book"></i>
            </span>
            Save as Draft
        </a>

        <a class="panel-block" href="#view-preview" id="action-preview">
            <span class="panel-icon">
                <i class="fa fa-eye"></i>
            </span>
            Preview
        </a>

    </div>
</div>
{% endblock %}

{% block body %}
    <div class="post-form-container content">
        <form action="{{ url_for('admin_save_post') }}" method="POST" id="post-form">
            <label class="label">Post Title</label>
            <p class="control">
                {% if not editing %}
                <input type="text" name="post-title" class="input" placeholder="No Title">
                {% else %}
                <input type="text" name="post-title" class="input" placeholder="No Title" value="{{ post.title }}">
                {% endif %}
            </p>
            <label class="label">Short Description</label>
            <p class="control">
                <textarea style="height:6em" class="input" name="post-description" id="post-description-editor">{% if editing %}{{ post.description }}{% endif %}</textarea>
            </p>
            <label class="label">Content</label>
            <p class="control">
              <textarea name="post-content" id="post-content-editor">{% if editing %}{{ post.content }}{% endif %}</textarea>
            </p>
            <label class="label">Tags</label>
            <p class="control">
                {% if not editing %}
                <input class="input" type="tags_with_awesomplete" name="post-tags" placeholder="Tags" data-tag-list="{% for tag in all_tags %} {{tag.name}} , {% endfor %}">
                {% else %}
                <input class="input" type="tags_with_awesomplete" name="post-tags" placeholder="Tags" data-tag-list="{% for tag in all_tags %} {{tag.name}} , {% endfor %}" value="{% for tag in tags_of_post %} {{tag.name}} , {% endfor %}">
                {% endif %}
            </p>
            <label class="label"> Status</label>
            <p class="control">
            {% if not editing %}
              <input class="switch is-primary " id="post-publish-switch" type="checkbox" name="post-publish" checked="checked">
            {% else %}
              <input class="switch is-primary" id="post-publish-switch" type="checkbox" name="post-publish" {% if post.published %} checked="checked" {% endif %}>
            {% endif %}
              <label class="label" id="post-publish-switch-label" for="post-publish-switch">Publish</label>
            </p>

            {% if editing %}
                <input type="hidden" name="post-edit-id" value="{{ post.id }}">
            {% endif %}

            <div class="has-text-right"><button id="post-submit-button" class="button is-primary is-large">Post</button></div>
        </form>
    </div>

    <div class="box post-content" id="preview-box" style="display:none;">
        <div class="preview-post content">
            <a name="view-preview"></a>
        </div>
    </div>
{% endblock %}

{% block javascript %}
<script src="{{ url_for('static', filename='js/tagsinput_with_awesomplete.js') }}"></script>
<script src="{{ url_for('static', filename='js/awesomplete_with_tagsinput.js') }}"></script>


<script type="text/javascript">

$(function() {
    var postForm = document.getElementById('post-form');
    var postEditor = new SimpleMDE({ element: document.getElementById("post-content-editor")});
    var postPublishSwitch = document.getElementById('post-publish-switch');
    var postPublishSwitchLabel = document.getElementById('post-publish-switch-label');

    var postSubmitButton = document.getElementById('post-submit-button');

    $("#action-draft").click(function(e) {
        postPublishSwitch.checked = false;
        postForm.submit();
    });

    $("#action-preview").click(function(e) {
        postData = { }
        postData['post-title'] = $("[name='post-title']").val();
        postData['post-content'] = postEditor.value();

        $.post("{{ url_for('preview') }}", postData).done(function(data) {
            $(".preview-post").html(data);
            $("#preview-box").show();
        });
    });

    $("#post-publish-switch").click(function(e) {
            postSubmitButton.innerHTML = postPublishSwitch.checked ? "Post" : "Save";
            postPublishSwitchLabel.innerHTML = postPublishSwitch.checked ? "Publish" : "Draft";
    });


});


</script>
{% endblock %}
